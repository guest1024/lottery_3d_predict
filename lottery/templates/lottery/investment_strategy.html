{% extends 'lottery/base.html' %}

{% block title %}æŠ•èµ„ç­–ç•¥åˆ†æ{% endblock %}

{% block content %}
<div style="padding: 30px; max-width: 1400px; margin: 0 auto;">
    <div style="margin-bottom: 30px; display: flex; justify-content: space-between; align-items: center;">
        <h1 style="margin: 0; color: #1f2937; font-size: 32px; font-weight: 700;">
            ğŸ“ˆ æŠ•èµ„ç­–ç•¥åˆ†æ
        </h1>
        <button onclick="runMonitor()" class="btn btn-success" style="padding: 12px 24px; font-size: 16px;">
            ğŸ”„ åˆ·æ–°è¯„ä¼°
        </button>
    </div>

    <!-- å½“å‰æœºä¼šè¯„ä¼° -->
    {% if current_opportunity %}
    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 16px; padding: 30px; margin-bottom: 30px; box-shadow: 0 10px 30px rgba(102,126,234,0.3);">
        <h2 style="color: white; font-size: 24px; margin-bottom: 20px; font-weight: 600;">
            ğŸ¯ å½“å‰æœºä¼šè¯„ä¼°
        </h2>
        
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
            <!-- è¯„åˆ†å¡ç‰‡ -->
            <div style="background: rgba(255,255,255,0.15); backdrop-filter: blur(10px); border-radius: 12px; padding: 20px; border: 1px solid rgba(255,255,255,0.2);">
                <div style="color: rgba(255,255,255,0.8); font-size: 14px; margin-bottom: 8px;">æœºä¼šè¯„åˆ†</div>
                <div style="color: white; font-size: 36px; font-weight: 700;">
                    {{ current_opportunity.opportunity_score|floatformat:2 }}
                    <span style="font-size: 18px; font-weight: 400;">åˆ†</span>
                </div>
                <div style="color: rgba(255,255,255,0.7); font-size: 13px; margin-top: 8px;">
                    é˜ˆå€¼: {{ current_opportunity.threshold|floatformat:2 }}åˆ†
                </div>
            </div>
            
            <!-- å»ºè®®å¡ç‰‡ -->
            <div style="background: rgba(255,255,255,0.15); backdrop-filter: blur(10px); border-radius: 12px; padding: 20px; border: 1px solid rgba(255,255,255,0.2);">
                <div style="color: rgba(255,255,255,0.8); font-size: 14px; margin-bottom: 8px;">æŠ•æ³¨å»ºè®®</div>
                {% if current_opportunity.recommendation == 'BET' %}
                <div style="color: #10b981; font-size: 28px; font-weight: 700; background: white; padding: 8px 16px; border-radius: 8px; display: inline-block;">
                    âœ… å»ºè®®æŠ•æ³¨
                </div>
                {% else %}
                <div style="color: #f59e0b; font-size: 28px; font-weight: 700; background: white; padding: 8px 16px; border-radius: 8px; display: inline-block;">
                    â¸ï¸ ç»§ç»­è§‚æœ›
                </div>
                {% endif %}
            </div>
            
            <!-- ä¸ŠæœŸå¼€å¥– -->
            <div style="background: rgba(255,255,255,0.15); backdrop-filter: blur(10px); border-radius: 12px; padding: 20px; border: 1px solid rgba(255,255,255,0.2);">
                <div style="color: rgba(255,255,255,0.8); font-size: 14px; margin-bottom: 8px;">ä¸ŠæœŸå¼€å¥–</div>
                <div style="color: white; font-size: 18px; font-weight: 600; margin-bottom: 4px;">
                    {{ current_opportunity.last_period.period }}
                </div>
                <div style="display: flex; gap: 8px;">
                    {% for num in current_opportunity.last_period.numbers %}
                    <div style="background: white; color: #667eea; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 20px; font-weight: 700;">
                        {{ num }}
                    </div>
                    {% endfor %}
                </div>
            </div>
            
            <!-- æ›´æ–°æ—¶é—´ -->
            <div style="background: rgba(255,255,255,0.15); backdrop-filter: blur(10px); border-radius: 12px; padding: 20px; border: 1px solid rgba(255,255,255,0.2);">
                <div style="color: rgba(255,255,255,0.8); font-size: 14px; margin-bottom: 8px;">æ›´æ–°æ—¶é—´</div>
                <div style="color: white; font-size: 16px; font-weight: 500;">
                    {{ current_opportunity.timestamp|slice:":19" }}
                </div>
            </div>
        </div>
        
        <!-- æŠ•æ³¨è®¡åˆ’ï¼ˆå¦‚æœå»ºè®®æŠ•æ³¨ï¼‰ -->
        {% if current_opportunity.recommendation == 'BET' %}
        <div style="margin-top: 25px; background: rgba(255,255,255,0.1); border-radius: 12px; padding: 20px;">
            <h3 style="color: white; font-size: 18px; margin-bottom: 15px; font-weight: 600;">ğŸ’° æŠ•æ³¨è®¡åˆ’</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                <div>
                    <div style="color: rgba(255,255,255,0.7); font-size: 13px;">æŠ•æ³¨æ³¨æ•°</div>
                    <div style="color: white; font-size: 24px; font-weight: 600;">{{ current_opportunity.betting_plan.num_bets }}æ³¨</div>
                </div>
                <div>
                    <div style="color: rgba(255,255,255,0.7); font-size: 13px;">æ€»æˆæœ¬</div>
                    <div style="color: white; font-size: 24px; font-weight: 600;">Â¥{{ current_opportunity.betting_plan.total_cost }}</div>
                </div>
                <div>
                    <div style="color: rgba(255,255,255,0.7); font-size: 13px;">é¢„æœŸèƒœç‡</div>
                    <div style="color: white; font-size: 24px; font-weight: 600;">66.7%</div>
                </div>
                <div>
                    <div style="color: rgba(255,255,255,0.7); font-size: 13px;">é¢„æœŸROI</div>
                    <div style="color: #10b981; font-size: 24px; font-weight: 600;">+405%</div>
                </div>
            </div>
            
            <details style="margin-top: 15px;">
                <summary style="color: white; cursor: pointer; font-size: 14px; padding: 10px; background: rgba(255,255,255,0.1); border-radius: 8px;">
                    æŸ¥çœ‹å‰20æ³¨æ¨è â–¼
                </summary>
                <div style="margin-top: 15px; display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 8px;">
                    {% for combo in current_opportunity.betting_plan.combinations|slice:":20" %}
                    <div style="background: rgba(255,255,255,0.15); padding: 8px; border-radius: 6px; text-align: center;">
                        <span style="color: white; font-size: 16px; font-weight: 600;">
                            {{ combo.0 }} {{ combo.1 }} {{ combo.2 }}
                        </span>
                    </div>
                    {% endfor %}
                </div>
            </details>
        </div>
        {% else %}
        <!-- è§‚æœ›å»ºè®® -->
        <div style="margin-top: 25px; background: rgba(255,255,255,0.1); border-radius: 12px; padding: 20px;">
            <h3 style="color: white; font-size: 18px; margin-bottom: 10px; font-weight: 600;">ğŸ’¡ è§‚æœ›å»ºè®®</h3>
            <p style="color: rgba(255,255,255,0.9); font-size: 15px; line-height: 1.6;">
                å½“å‰è¯„åˆ†æœªè¾¾åˆ°æŠ•æ³¨é˜ˆå€¼ï¼Œå»ºè®®ç»§ç»­è§‚æœ›ã€‚<br>
                è¯„åˆ†å·®è·: <strong>{{ current_opportunity.score_gap|floatformat:2 }}åˆ†</strong><br>
                ç­‰å¾…è¯„åˆ† â‰¥ {{ current_opportunity.threshold|floatformat:2 }}åˆ†æ—¶å†å…¥åœºã€‚
            </p>
        </div>
        {% endif %}
    </div>
    {% else %}
    <div style="background: #f3f4f6; border-radius: 12px; padding: 30px; text-align: center; margin-bottom: 30px;">
        <div style="font-size: 48px; margin-bottom: 15px;">ğŸ“Š</div>
        <p style="color: #6b7280; font-size: 16px;">æš‚æ— å½“å‰æœºä¼šè¯„ä¼°æ•°æ®</p>
        <button onclick="runMonitor()" class="btn btn-primary" style="margin-top: 15px;">
            ç«‹å³è¯„ä¼°
        </button>
    </div>
    {% endif %}

    <!-- ç­–ç•¥å¯¹æ¯” -->
    {% if golden_opportunities %}
    <div style="background: white; border-radius: 16px; padding: 30px; margin-bottom: 30px; box-shadow: 0 4px 20px rgba(0,0,0,0.08);">
        <h2 style="color: #1f2937; font-size: 24px; margin-bottom: 20px; font-weight: 600;">
            ğŸ“Š å†å²å›æµ‹ç»“æœ
        </h2>
        
        <div style="margin-bottom: 25px;">
            <h3 style="color: #4b5563; font-size: 18px; margin-bottom: 15px;">é¢„æµ‹å‡†ç¡®ç‡ç»Ÿè®¡</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                <div style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); border-radius: 12px; padding: 20px; color: white;">
                    <div style="font-size: 14px; opacity: 0.9; margin-bottom: 8px;">Top10å®Œå…¨å‘½ä¸­ç‡</div>
                    <div style="font-size: 32px; font-weight: 700;">
                        74.0%
                    </div>
                    <div style="font-size: 13px; opacity: 0.8; margin-top: 8px;">
                        {{ golden_opportunities.summary.full_hit_count }}/{{ golden_opportunities.summary.total_periods }}æœŸ
                    </div>
                </div>
                
                <div style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); border-radius: 12px; padding: 20px; color: white;">
                    <div style="font-size: 14px; opacity: 0.9; margin-bottom: 8px;">éƒ¨åˆ†å‘½ä¸­ç‡</div>
                    <div style="font-size: 32px; font-weight: 700;">
                        26.0%
                    </div>
                    <div style="font-size: 13px; opacity: 0.8; margin-top: 8px;">
                        {{ golden_opportunities.summary.partial_hit_count }}/{{ golden_opportunities.summary.total_periods }}æœŸ
                    </div>
                </div>
            </div>
        </div>
        
        <div>
            <h3 style="color: #4b5563; font-size: 18px; margin-bottom: 15px;">è¯„åˆ†åˆ†å¸ƒä¸å‘½ä¸­ç‡</h3>
            <div style="background: #f9fafb; border-radius: 8px; padding: 20px;">
                <table style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr style="border-bottom: 2px solid #e5e7eb;">
                            <th style="text-align: left; padding: 12px; color: #6b7280; font-weight: 600;">è¯„åˆ†åŒºé—´</th>
                            <th style="text-align: left; padding: 12px; color: #6b7280; font-weight: 600;">é˜ˆå€¼</th>
                            <th style="text-align: left; padding: 12px; color: #6b7280; font-weight: 600;">è¯´æ˜</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr style="border-bottom: 1px solid #f3f4f6;">
                            <td style="padding: 12px; color: #1f2937; font-weight: 600;">Top1% æé«˜åˆ†</td>
                            <td style="padding: 12px; color: #1f2937; font-family: monospace;">â‰¥ {{ golden_opportunities.scoring_system.score_distribution.percentile_99|floatformat:2 }}</td>
                            <td style="padding: 12px; color: #059669; font-weight: 600;">âœ… æ¨èæŠ•æ³¨ï¼ˆèƒœç‡67%ï¼ŒROI +405%ï¼‰</td>
                        </tr>
                        <tr style="border-bottom: 1px solid #f3f4f6;">
                            <td style="padding: 12px; color: #1f2937; font-weight: 600;">Top5% é«˜åˆ†</td>
                            <td style="padding: 12px; color: #1f2937; font-family: monospace;">â‰¥ {{ golden_opportunities.scoring_system.score_distribution.percentile_95|floatformat:2 }}</td>
                            <td style="padding: 12px; color: #dc2626;">âŒ ä¸æ¨èï¼ˆèƒœç‡20%ï¼ŒROI -57%ï¼‰</td>
                        </tr>
                        <tr>
                            <td style="padding: 12px; color: #1f2937; font-weight: 600;">Top10% ä¸­ç­‰</td>
                            <td style="padding: 12px; color: #1f2937; font-family: monospace;">â‰¥ {{ golden_opportunities.scoring_system.score_distribution.percentile_90|floatformat:2 }}</td>
                            <td style="padding: 12px; color: #dc2626;">âŒ ä¸æ¨èï¼ˆèƒœç‡17%ï¼ŒROI -13%ï¼‰</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        
        <div style="margin-top: 25px;">
            <h3 style="color: #4b5563; font-size: 18px; margin-bottom: 15px;">ğŸŒŸ å†å²Top10é«˜åˆ†æœºä¼š</h3>
            <div style="background: #f9fafb; border-radius: 8px; padding: 15px; max-height: 400px; overflow-y: auto;">
                <table style="width: 100%; border-collapse: collapse;">
                    <thead style="position: sticky; top: 0; background: #f9fafb;">
                        <tr style="border-bottom: 2px solid #e5e7eb;">
                            <th style="text-align: left; padding: 10px; color: #6b7280; font-weight: 600; font-size: 13px;">æœŸå·</th>
                            <th style="text-align: left; padding: 10px; color: #6b7280; font-weight: 600; font-size: 13px;">æ—¥æœŸ</th>
                            <th style="text-align: left; padding: 10px; color: #6b7280; font-weight: 600; font-size: 13px;">å®é™…å·ç </th>
                            <th style="text-align: right; padding: 10px; color: #6b7280; font-weight: 600; font-size: 13px;">è¯„åˆ†</th>
                            <th style="text-align: center; padding: 10px; color: #6b7280; font-weight: 600; font-size: 13px;">å‘½ä¸­</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for opp in golden_opportunities.top_opportunities|slice:":20" %}
                        <tr style="border-bottom: 1px solid #f3f4f6;">
                            <td style="padding: 10px; color: #1f2937; font-size: 14px;">{{ opp.period }}</td>
                            <td style="padding: 10px; color: #6b7280; font-size: 13px;">{{ opp.date }}</td>
                            <td style="padding: 10px;">
                                <span style="display: inline-flex; gap: 6px;">
                                    {% for num in opp.actual_numbers %}
                                    <span style="background: #667eea; color: white; width: 28px; height: 28px; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; font-size: 13px; font-weight: 600;">
                                        {{ num }}
                                    </span>
                                    {% endfor %}
                                </span>
                            </td>
                            <td style="padding: 10px; color: #1f2937; font-weight: 600; text-align: right; font-size: 14px;">
                                {{ opp.opportunity_score|floatformat:2 }}
                            </td>
                            <td style="padding: 10px; text-align: center; font-size: 16px;">
                                {% if opp.full_hit_top10 %}
                                <span style="color: #10b981;">âœ“</span>
                                {% else %}
                                <span style="color: #f59e0b;">{{ opp.hit_in_top10 }}/3</span>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- ä½¿ç”¨æŒ‡å— -->
    <div style="background: #fef3c7; border-left: 4px solid #f59e0b; border-radius: 8px; padding: 20px; margin-top: 30px;">
        <h3 style="color: #92400e; font-size: 18px; margin-bottom: 12px; font-weight: 600;">âš ï¸ æŠ•èµ„é£é™©æç¤º</h3>
        <ul style="color: #78350f; line-height: 1.8; margin: 0; padding-left: 20px;">
            <li>å½©ç¥¨æ˜¯æ¦‚ç‡æ¸¸æˆï¼Œå†å²ä¸šç»©ä¸ä»£è¡¨æœªæ¥è¡¨ç°</li>
            <li>å³ä½¿Top1%ç­–ç•¥å†å²èƒœç‡67%ï¼Œä»æœ‰33%æ¦‚ç‡äºæŸ</li>
            <li>å»ºè®®å•æ¬¡æŠ•æ³¨é‡‘é¢ â‰¤ æ€»èµ„é‡‘çš„5%</li>
            <li>ç†æ€§è´­å½©ï¼Œå¨±ä¹ä¸ºä¸»ï¼Œåˆ‡å‹¿æ²‰è¿·</li>
            <li>æœ¬ç³»ç»Ÿä»…ä¾›å­¦ä¹ ç ”ç©¶ä½¿ç”¨ï¼Œä¸æ„æˆæŠ•èµ„å»ºè®®</li>
        </ul>
    </div>
</div>

<script>
async function runMonitor() {
    if (!confirm('ç¡®å®šè¦é‡æ–°è¯„ä¼°å½“å‰æœºä¼šå—ï¼Ÿ\nè¿™å°†è¿è¡Œå®æ—¶ç›‘æ§è„šæœ¬ã€‚')) {
        return;
    }
    
    // TODO: å®ç°AJAXè°ƒç”¨åç«¯è¿è¡Œmonitorè„šæœ¬
    alert('åŠŸèƒ½å¼€å‘ä¸­ï¼šå°†è¿è¡Œ realtime_opportunity_monitor.py å¹¶åˆ·æ–°é¡µé¢');
    
    // ä¸´æ—¶æ–¹æ¡ˆï¼šåˆ·æ–°é¡µé¢
    location.reload();
}
</script>
{% endblock %}
