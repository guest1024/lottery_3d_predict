{% extends 'lottery/base.html' %}

{% block title %}ç‰¹å¾æå– - {{ period.period }} - 3Då½©ç¥¨é¢„æµ‹ç³»ç»Ÿ{% endblock %}

{% block content %}
<h1 style="margin-bottom: 20px; color: #303133;">
    <a href="{% url 'lottery:period_detail' period.period %}" style="text-decoration: none; color: #409eff;">â†</a>
    ç‰¹å¾æå–: {{ period.period }}
</h1>

{% if error %}
<div class="card">
    <div class="empty-state">
        <div class="empty-state-icon">âš ï¸</div>
        <p>{{ error }}</p>
        <a href="{% url 'lottery:history_list' %}" class="btn btn-primary" style="margin-top: 16px;">è¿”å›åˆ—è¡¨</a>
    </div>
</div>
{% else %}

<!-- Tabå¯¼èˆª -->
<div class="tabs">
    <div class="tab-buttons">
        <button class="tab-btn">è¾“å…¥åºåˆ—</button>
        <button class="tab-btn">æ•°å­—é¢‘ç‡</button>
        <button class="tab-btn">å’Œå€¼åˆ†å¸ƒ</button>
        <button class="tab-btn">å½¢æ€ç»Ÿè®¡</button>
    </div>
</div>

<!-- Tab 1: è¾“å…¥åºåˆ— -->
<div class="tab-content">
    <div class="card">
        <div class="card-title">è®­ç»ƒè¾“å…¥åºåˆ—ï¼ˆå‰30æœŸï¼‰</div>
        <p style="color: #606266; margin-bottom: 15px;">
            è¯¥æœŸé¢„æµ‹æ—¶æ¨¡å‹çš„è¾“å…¥ç‰¹å¾ï¼Œå½¢çŠ¶ä¸º [30, 3]
        </p>
        <div style="max-height: 500px; overflow-y: auto;">
            <table class="table">
                <thead>
                    <tr>
                        <th>åºå·</th>
                        <th>æœŸå·</th>
                        <th>å·ç åºåˆ—</th>
                        <th>å½¢æ€</th>
                        <th>å’Œå€¼</th>
                    </tr>
                </thead>
                <tbody>
                    {% for period_obj, seq in history_30 %}
                    <tr>
                        <td>{{ forloop.counter }}</td>
                        <td>{{ period_obj.period }}</td>
                        <td>
                            <div class="lottery-balls">
                                <div class="ball" style="width: 28px; height: 28px; font-size: 13px;">{{ seq.0 }}</div>
                                <div class="ball" style="width: 28px; height: 28px; font-size: 13px;">{{ seq.1 }}</div>
                                <div class="ball" style="width: 28px; height: 28px; font-size: 13px;">{{ seq.2 }}</div>
                            </div>
                        </td>
                        <td><span class="tag tag-info">{{ period_obj.shape }}</span></td>
                        <td>{{ period_obj.sum_value }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Tab 2: æ•°å­—é¢‘ç‡ -->
<div class="tab-content">
    <div class="card">
        <div class="card-title">æ•°å­—å‡ºç°é¢‘ç‡ï¼ˆ0-9ï¼‰</div>
        <p style="color: #606266; margin-bottom: 15px;">
            å‰30æœŸä¸­å„æ•°å­—å‡ºç°çš„æ¬¡æ•°ç»Ÿè®¡
        </p>
        <div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 15px;">
            {% for digit, count in digit_freq.items %}
            <div style="text-align: center; padding: 20px; background: #f5f7fa; border-radius: 8px;">
                <div class="ball" style="margin: 0 auto 10px;">{{ digit }}</div>
                <div style="font-size: 24px; font-weight: bold; color: #303133;">{{ count }}</div>
                <div style="color: #909399; font-size: 13px;">æ¬¡</div>
            </div>
            {% endfor %}
        </div>
        
        <div style="margin-top: 30px; padding: 15px; background: #f0f9ff; border-radius: 4px;">
            <p style="color: #606266;">
                <strong>ç‰¹å¾è¯´æ˜:</strong> æ•°å­—é¢‘ç‡ç‰¹å¾å¯ä»¥åæ˜ å‡ºå†å²è¶‹åŠ¿ï¼Œæ¨¡å‹ä¼šå­¦ä¹ å“ªäº›æ•°å­—åœ¨æœ€è¿‘æ—¶æ®µå‡ºç°æ›´é¢‘ç¹ã€‚
            </p>
        </div>
    </div>
</div>

<!-- Tab 3: å’Œå€¼åˆ†å¸ƒ -->
<div class="tab-content">
    <div class="card">
        <div class="card-title">å’Œå€¼ç»Ÿè®¡</div>
        <div class="stat-grid">
            <div class="stat-card">
                <div class="stat-label">æœ€å°å€¼</div>
                <div class="stat-value">{{ sum_values.min }}</div>
            </div>
            <div class="stat-card success">
                <div class="stat-label">å¹³å‡å€¼</div>
                <div class="stat-value">{{ sum_values.avg|floatformat:1 }}</div>
            </div>
            <div class="stat-card warning">
                <div class="stat-label">æœ€å¤§å€¼</div>
                <div class="stat-value">{{ sum_values.max }}</div>
            </div>
        </div>
        
        <div style="margin-top: 20px; padding: 15px; background: #f0f9ff; border-radius: 4px;">
            <p style="color: #606266;">
                <strong>ç‰¹å¾è¯´æ˜:</strong> å’Œå€¼èŒƒå›´0-27ï¼Œç†è®ºå¹³å‡å€¼ä¸º13.5ã€‚å’Œå€¼ç‰¹å¾å¯ä»¥å¸®åŠ©æ¨¡å‹ç†è§£å·ç ç»„åˆçš„æ•´ä½“åˆ†å¸ƒã€‚
            </p>
        </div>
    </div>
</div>

<!-- Tab 4: å½¢æ€ç»Ÿè®¡ -->
<div class="tab-content">
    <div class="card">
        <div class="card-title">å½¢æ€åˆ†å¸ƒ</div>
        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px;">
            {% for shape, data in shape_freq.items %}
            <div style="text-align: center; padding: 30px; background: #f5f7fa; border-radius: 8px;">
                <div style="font-size: 32px; margin-bottom: 10px;">
                    {% if shape == 'è±¹å­' %}ğŸ”¥{% elif shape == 'ç»„ä¸‰' %}âš¡{% else %}ğŸ’{% endif %}
                </div>
                <div style="font-size: 18px; color: #303133; margin-bottom: 5px;">{{ shape }}</div>
                <div style="font-size: 28px; font-weight: bold; color: #409eff;">{{ data.count }}</div>
                <div style="color: #909399; font-size: 13px;">æ¬¡ ({{ data.percentage }}%)</div>
            </div>
            {% endfor %}
        </div>
        
        <div style="margin-top: 30px; padding: 15px; background: #f0f9ff; border-radius: 4px;">
            <p style="color: #606266; margin-bottom: 10px;">
                <strong>å½¢æ€å®šä¹‰:</strong>
            </p>
            <ul style="margin-left: 20px; color: #606266; line-height: 1.8;">
                <li><strong>è±¹å­:</strong> ä¸‰ä¸ªæ•°å­—ç›¸åŒï¼Œå¦‚ [5,5,5]ï¼Œç†è®ºæ¦‚ç‡1%</li>
                <li><strong>ç»„ä¸‰:</strong> ä¸¤ä¸ªæ•°å­—ç›¸åŒï¼Œå¦‚ [1,1,2]ï¼Œç†è®ºæ¦‚ç‡27%</li>
                <li><strong>ç»„å…­:</strong> ä¸‰ä¸ªæ•°å­—éƒ½ä¸åŒï¼Œå¦‚ [1,2,3]ï¼Œç†è®ºæ¦‚ç‡72%</li>
            </ul>
        </div>
    </div>
</div>

<div style="margin-top: 20px;">
    <a href="{% url 'lottery:period_detail' period.period %}" class="btn btn-primary">è¿”å›æœŸå·è¯¦æƒ…</a>
    <a href="{% url 'lottery:history_list' %}" class="btn" style="background: #dcdfe6; color: #606266;">è¿”å›åˆ—è¡¨</a>
</div>

{% endif %}
{% endblock %}

{% block extra_js %}
<script>
// åœ¨ç‰¹å¾æå–é¡µæ·»åŠ ç™¾åˆ†æ¯”è®¡ç®—
document.addEventListener('DOMContentLoaded', () => {
    // è®¡ç®—å·²åœ¨æ¨¡æ¿ä¸­å¤„ç†
});
</script>
{% endblock %}
