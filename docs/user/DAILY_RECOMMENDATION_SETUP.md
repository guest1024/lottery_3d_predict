# æ¯æ—¥æŠ•æ³¨å»ºè®®è‡ªåŠ¨åŒ–è®¾ç½®æŒ‡å—

æœ¬æ–‡æ¡£ä»‹ç»å¦‚ä½•è®¾ç½®æ¯æ—¥è‡ªåŠ¨ç”ŸæˆæŠ•æ³¨å»ºè®®çš„åŠŸèƒ½ã€‚

---

## åŠŸèƒ½æ¦‚è¿°

### å·¥ä½œæµç¨‹

1. **æ¯å¤©å®šæ—¶æ‰§è¡Œ**ï¼ˆä¾‹å¦‚ï¼šæ¯å¤©20:00ï¼‰
2. **åˆ†ææœ€æ–°æ•°æ®**ï¼šè¯»å–æœ€è¿‘30æœŸå†å²å¼€å¥–
3. **æ¨¡å‹é¢„æµ‹**ï¼šä½¿ç”¨LSTMæ¨¡å‹é¢„æµ‹ä¸‹ä¸€æœŸæ•°å­—æ¦‚ç‡
4. **ç½®ä¿¡åº¦è¯„ä¼°**ï¼šè®¡ç®—ç½®ä¿¡åº¦è¯„åˆ†ï¼Œå¹¶ä¸å†å²1000æœŸå¯¹æ¯”æ’å
5. **æŠ•æ³¨å†³ç­–**ï¼š
   - **Top5ç­–ç•¥**ï¼šä»…å½“ç½®ä¿¡åº¦æ’åå‰5%æ—¶å»ºè®®æŠ•æ³¨
   - **å»ºè®®æŠ•æ³¨**ï¼šç”Ÿæˆ100æ³¨å…·ä½“ç»„åˆï¼Œæˆæœ¬200å…ƒ
   - **ä¸å»ºè®®æŠ•æ³¨**ï¼šç½®ä¿¡åº¦ä¸è¶³ï¼Œå»ºè®®ç­‰å¾…
6. **ç»“æœä¿å­˜**ï¼šå»ºè®®ä¿å­˜åˆ°æ•°æ®åº“ï¼Œå¯é€šè¿‡å‰ç«¯æŸ¥çœ‹

---

## å¿«é€Ÿå¼€å§‹

### æ–¹æ³•1: æ‰‹åŠ¨æ‰§è¡Œ

```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd /c1/program/lottery_3d_predict

# æ‰§è¡ŒæŠ•æ³¨å»ºè®®ç”Ÿæˆï¼ˆTop5ç­–ç•¥ï¼‰
python tools/betting/daily_recommendation.py --strategy top5

# æŸ¥çœ‹å¸®åŠ©
python tools/betting/daily_recommendation.py --help
```

### æ–¹æ³•2: ä½¿ç”¨Shellè„šæœ¬

```bash
# æ‰§è¡Œè„šæœ¬
bash tools/betting/schedule_daily_recommendation.sh

# æŸ¥çœ‹æ—¥å¿—
tail -f logs/betting/daily_recommendation_*.log
```

---

## è®¾ç½®å®šæ—¶ä»»åŠ¡ (Crontab)

### æ­¥éª¤1: ç¼–è¾‘crontab

```bash
crontab -e
```

### æ­¥éª¤2: æ·»åŠ å®šæ—¶ä»»åŠ¡

```bash
# æ¯å¤©20:00æ‰§è¡ŒæŠ•æ³¨å»ºè®®ç”Ÿæˆ
0 20 * * * /c1/program/lottery_3d_predict/tools/betting/schedule_daily_recommendation.sh

# æˆ–è€…æ¯å¤©18:00å’Œ20:00å„æ‰§è¡Œä¸€æ¬¡
0 18,20 * * * /c1/program/lottery_3d_predict/tools/betting/schedule_daily_recommendation.sh
```

### æ­¥éª¤3: éªŒè¯å®šæ—¶ä»»åŠ¡

```bash
# åˆ—å‡ºå½“å‰çš„crontabä»»åŠ¡
crontab -l

# æŸ¥çœ‹cronæ—¥å¿—ï¼ˆLinuxï¼‰
tail -f /var/log/cron

# æŸ¥çœ‹æ‰§è¡Œæ—¥å¿—
tail -f /c1/program/lottery_3d_predict/logs/betting/daily_recommendation_*.log
```

---

## å‘½ä»¤è¡Œå‚æ•°

### å®Œæ•´å‚æ•°åˆ—è¡¨

```bash
python tools/betting/daily_recommendation.py \
    --model models/best_model.pth \     # æ¨¡å‹è·¯å¾„ï¼ˆå¯é€‰ï¼Œé»˜è®¤best_model.pthï¼‰
    --strategy top5 \                    # ç­–ç•¥ï¼štop5, top10, top20
    --window 30 \                        # å†å²çª—å£å¤§å°
    --device cpu \                       # è®¡ç®—è®¾å¤‡ï¼šcpuæˆ–cuda
    --no-save                            # ä¸ä¿å­˜åˆ°æ•°æ®åº“ï¼ˆæµ‹è¯•æ—¶ä½¿ç”¨ï¼‰
```

### ç­–ç•¥é€‰æ‹©

| ç­–ç•¥ | æŠ•æ³¨é˜ˆå€¼ | æŠ•æ³¨ç‡ | ROI (å›æµ‹) | é€‚ç”¨åœºæ™¯ |
|------|---------|-------|----------|---------|
| **top5** | å‰5% | 5% | **+98.4%** | ğŸ”¥ **æ¨è** - æåº¦ä¿å®ˆï¼Œé«˜ROI |
| top10 | å‰10% | 10% | +49.3% | å¹³è¡¡ - æŠ•æ³¨é¢‘ç‡é€‚ä¸­ |
| top20 | å‰20% | 20% | +26.4% | æ¿€è¿› - æŠ•æ³¨é¢‘ç‡è¾ƒé«˜ |

**æ¨èä½¿ç”¨Top5ç­–ç•¥**ï¼š
- ROIé«˜è¾¾98.4%
- åªåœ¨æœ€æœ‰æŠŠæ¡æ—¶æŠ•æ³¨
- 500æœŸæµ‹è¯•ä¸­ä»…æŠ•æ³¨25æœŸï¼Œ24%èƒœç‡

---

## è¾“å‡ºç¤ºä¾‹

### ç¤ºä¾‹1: å»ºè®®æŠ•æ³¨

```
================================================================================
æ¯æ—¥æŠ•æ³¨å»ºè®®ç”Ÿæˆ
================================================================================
æ—¶é—´: 2026-02-06 20:00:15
ç­–ç•¥: TOP5

åŠ è½½æ¨¡å‹: /c1/program/lottery_3d_predict/models/best_model.pth
è·å–æœ€æ–°å†å²æ•°æ®...
æœ€æ–°æœŸå·: 2026-02-05
å¼€å¥–æ—¥æœŸ: 2026-02-05
å†å²çª—å£: 30æœŸ

é¢„æµ‹ä¸‹ä¸€æœŸ...
è®¡ç®—ç½®ä¿¡åº¦...
  ç»¼åˆå¾—åˆ†: 17.82
  Top5é›†ä¸­åº¦: 1.389
  Top3å·®è·: 0.045

è®¡ç®—å†å²ç™¾åˆ†ä½æ’åï¼ˆè¿™å¯èƒ½éœ€è¦å‡ åˆ†é’Ÿï¼‰...
  ç™¾åˆ†ä½æ’å: 96.3%

âœ… å»ºè®®æŠ•æ³¨
  æ¡£æ¬¡: æé«˜
  å»ºè®®æ³¨æ•°: 100æ³¨
  é¢„è®¡æˆæœ¬: 200å…ƒ

ç”ŸæˆæŠ•æ³¨ç»„åˆ...
  å…±ç”Ÿæˆ 25 ä¸ªç»„åˆ
  æ€»æˆæœ¬: 200å…ƒ

Top 5 æŠ•æ³¨ç»„åˆ:
  1. (1, 3, 7) (group6) - 12æ³¨, æˆæœ¬24å…ƒ, å¥–é‡‘320å…ƒ
  2. (2, 5, 9) (group6) - 10æ³¨, æˆæœ¬20å…ƒ, å¥–é‡‘320å…ƒ
  3. (1, 1, 8) (group3) - 9æ³¨, æˆæœ¬18å…ƒ, å¥–é‡‘160å…ƒ
  4. (3, 4, 7) (group6) - 8æ³¨, æˆæœ¬16å…ƒ, å¥–é‡‘320å…ƒ
  5. (0, 3, 9) (group6) - 7æ³¨, æˆæœ¬14å…ƒ, å¥–é‡‘320å…ƒ

Top 5 é¢„æµ‹æ•°å­—:
  1. æ•°å­— 7: æ¦‚ç‡ 0.312
  2. æ•°å­— 3: æ¦‚ç‡ 0.298
  3. æ•°å­— 1: æ¦‚ç‡ 0.287
  4. æ•°å­— 9: æ¦‚ç‡ 0.276
  5. æ•°å­— 5: æ¦‚ç‡ 0.269

ä¿å­˜å»ºè®®åˆ°æ•°æ®åº“...
  ä¿å­˜æˆåŠŸï¼ŒID: 12345

================================================================================
```

### ç¤ºä¾‹2: ä¸å»ºè®®æŠ•æ³¨

```
================================================================================
æ¯æ—¥æŠ•æ³¨å»ºè®®ç”Ÿæˆ
================================================================================
æ—¶é—´: 2026-02-07 20:00:18
ç­–ç•¥: TOP5

...

è®¡ç®—å†å²ç™¾åˆ†ä½æ’åï¼ˆè¿™å¯èƒ½éœ€è¦å‡ åˆ†é’Ÿï¼‰...
  ç™¾åˆ†ä½æ’å: 87.2%

âš ï¸  ä¸å»ºè®®æŠ•æ³¨
  åŸå› : ç½®ä¿¡åº¦æ’å 87.2%ï¼Œæœªè¾¾åˆ°æŠ•æ³¨é˜ˆå€¼(95%)
  å»ºè®®: ç­‰å¾…æ›´é«˜ç½®ä¿¡åº¦çš„æ—¶æœº

Top 5 é¢„æµ‹æ•°å­—:
  1. æ•°å­— 4: æ¦‚ç‡ 0.289
  2. æ•°å­— 2: æ¦‚ç‡ 0.275
  3. æ•°å­— 8: æ¦‚ç‡ 0.268
  4. æ•°å­— 1: æ¦‚ç‡ 0.265
  5. æ•°å­— 6: æ¦‚ç‡ 0.261

================================================================================
```

---

## æ—¥å¿—ç®¡ç†

### æ—¥å¿—ä½ç½®

```bash
logs/betting/daily_recommendation_YYYYMMDD_HHMMSS.log
```

### æ—¥å¿—æŸ¥çœ‹

```bash
# æŸ¥çœ‹æœ€æ–°æ—¥å¿—
ls -lt logs/betting/ | head -5

# å®æ—¶æŸ¥çœ‹æ—¥å¿—
tail -f logs/betting/daily_recommendation_$(date +%Y%m%d)*.log

# æŸ¥çœ‹æœ€è¿‘7å¤©çš„æŠ•æ³¨å»ºè®®
find logs/betting/ -name "*.log" -mtime -7 -exec grep -l "å»ºè®®æŠ•æ³¨" {} \;
```

### æ—¥å¿—æ¸…ç†

è„šæœ¬ä¼šè‡ªåŠ¨æ¸…ç†30å¤©å‰çš„æ—¥å¿—ã€‚å¦‚éœ€æ‰‹åŠ¨æ¸…ç†ï¼š

```bash
# åˆ é™¤30å¤©å‰çš„æ—¥å¿—
find logs/betting/ -name "*.log" -mtime +30 -delete

# åˆ é™¤æ‰€æœ‰æ—¥å¿—
rm -rf logs/betting/*.log
```

---

## é›†æˆåˆ°å‰ç«¯

### æ•°æ®åº“æŸ¥è¯¢

å»ºè®®å·²ä¿å­˜åˆ° `Prediction` æ¨¡å‹ï¼Œå¯é€šè¿‡APIæŸ¥è¯¢ï¼š

```python
from lottery.models import Prediction
from datetime import date, timedelta

# è·å–æœ€æ–°çš„é¢„æµ‹
latest_prediction = Prediction.objects.latest('id')

# è·å–ä»Šå¤©çš„é¢„æµ‹
today_predictions = Prediction.objects.filter(
    period__date=date.today()
)

# æ£€æŸ¥æ˜¯å¦å»ºè®®æŠ•æ³¨
# (éœ€è¦åœ¨Predictionæ¨¡å‹ä¸­æ·»åŠ recommendationå­—æ®µ)
```

### APIç«¯ç‚¹å»ºè®®

```python
# views.py
from django.http import JsonResponse
from lottery.models import Prediction

def get_latest_recommendation(request):
    """è·å–æœ€æ–°æŠ•æ³¨å»ºè®®"""
    try:
        pred = Prediction.objects.latest('id')
        
        # åˆ¤æ–­æ˜¯å¦å»ºè®®æŠ•æ³¨ï¼ˆåŸºäºç½®ä¿¡åº¦ï¼‰
        should_bet = pred.confidence_score >= calculate_threshold()
        
        return JsonResponse({
            'success': True,
            'recommendation': 'bet' if should_bet else 'no_bet',
            'confidence_score': pred.confidence_score,
            'top5_digits': pred.top5_digits,
            'predicted_for_period': pred.predicted_for_period,
            # ... å…¶ä»–å­—æ®µ
        })
    except Prediction.DoesNotExist:
        return JsonResponse({
            'success': False,
            'message': 'æš‚æ— é¢„æµ‹æ•°æ®'
        })
```

---

## ç›‘æ§ä¸å‘Šè­¦

### å¥åº·æ£€æŸ¥

```bash
# æ£€æŸ¥è„šæœ¬æ˜¯å¦æ­£å¸¸æ‰§è¡Œ
if [ $(find logs/betting/ -name "daily_recommendation_$(date +%Y%m%d)*.log" | wc -l) -eq 0 ]; then
    echo "âš ï¸  ä»Šå¤©è¿˜æ²¡æœ‰ç”ŸæˆæŠ•æ³¨å»ºè®®"
fi

# æ£€æŸ¥æ˜¯å¦æœ‰é”™è¯¯
grep -i "error\|failed\|traceback" logs/betting/daily_recommendation_$(date +%Y%m%d)*.log
```

### é‚®ä»¶/çŸ­ä¿¡å‘Šè­¦

å¯ä»¥åœ¨è„šæœ¬ä¸­æ·»åŠ å‘Šè­¦åŠŸèƒ½ï¼š

```bash
# schedule_daily_recommendation.sh ä¸­æ·»åŠ 

# å¦‚æœå»ºè®®æŠ•æ³¨ï¼Œå‘é€é€šçŸ¥
if grep -q "âœ… å»ºè®®æŠ•æ³¨" "$LOG_FILE"; then
    # å‘é€é‚®ä»¶
    echo "ä»Šæ—¥å»ºè®®æŠ•æ³¨ï¼Œç½®ä¿¡åº¦å‰5%" | mail -s "å½©ç¥¨æŠ•æ³¨å»ºè®®" user@example.com
    
    # æˆ–ä½¿ç”¨å…¶ä»–é€šçŸ¥æœåŠ¡ï¼ˆé’‰é’‰ã€å¾®ä¿¡ç­‰ï¼‰
    # curl -X POST https://oapi.dingtalk.com/robot/send?access_token=XXX ...
fi
```

---

## å¸¸è§é—®é¢˜

### Q1: è®¡ç®—ç™¾åˆ†ä½æ’åå¤ªæ…¢æ€ä¹ˆåŠï¼Ÿ

**ç­”**: è®¡ç®—å†å²1000æœŸçš„ç½®ä¿¡åº¦éœ€è¦1-2åˆ†é’Ÿã€‚å¯ä»¥ä¼˜åŒ–ï¼š

```python
# æ–¹æ¡ˆ1: å‡å°‘lookbackæœŸæ•°
percentile = calculate_historical_percentile(
    confidence['composite_score'], 
    lookback_periods=500  # ä»1000å‡å°‘åˆ°500
)

# æ–¹æ¡ˆ2: ç¼“å­˜å†å²ç½®ä¿¡åº¦ï¼ˆæ¯å¤©åªè®¡ç®—ä¸€æ¬¡ï¼‰
# å°†å†å²ç½®ä¿¡åº¦ä¿å­˜åˆ°æ–‡ä»¶ï¼Œåç»­ç›´æ¥åŠ è½½
```

### Q2: å¦‚ä½•æµ‹è¯•ä¸åŒç­–ç•¥ï¼Ÿ

**ç­”**: ä½¿ç”¨ `--strategy` å‚æ•°ï¼š

```bash
# æµ‹è¯•Top10ç­–ç•¥
python tools/betting/daily_recommendation.py --strategy top10 --no-save

# æµ‹è¯•Top20ç­–ç•¥
python tools/betting/daily_recommendation.py --strategy top20 --no-save
```

### Q3: å¦‚ä½•å¤‡ä»½å’Œæ¢å¤æ¨¡å‹ï¼Ÿ

**ç­”**:

```bash
# å¤‡ä»½æ¨¡å‹
cp models/best_model.pth models/best_model_backup_$(date +%Y%m%d).pth

# ä½¿ç”¨å¤‡ä»½æ¨¡å‹
python tools/betting/daily_recommendation.py \
    --model models/best_model_backup_20260205.pth
```

### Q4: å®šæ—¶ä»»åŠ¡æ²¡æœ‰æ‰§è¡Œæ€ä¹ˆåŠï¼Ÿ

**ç­”**: æ£€æŸ¥æ­¥éª¤ï¼š

1. ç¡®è®¤cronæœåŠ¡è¿è¡Œ: `systemctl status cron` (Linux) æˆ– `service cron status`
2. æ£€æŸ¥crontabè¯­æ³•: `crontab -l`
3. æŸ¥çœ‹cronæ—¥å¿—: `tail -f /var/log/cron`
4. ç¡®ä¿è„šæœ¬æœ‰æ‰§è¡Œæƒé™: `chmod +x tools/betting/schedule_daily_recommendation.sh`
5. æµ‹è¯•è„šæœ¬æ‰‹åŠ¨æ‰§è¡Œ: `bash tools/betting/schedule_daily_recommendation.sh`

---

## æ€§èƒ½æŒ‡æ ‡ï¼ˆå›æµ‹æ•°æ®ï¼‰

åŸºäº500æœŸå†å²æ•°æ®å›æµ‹ï¼š

### Top5ç­–ç•¥

- **æŠ•æ³¨æœŸæ•°**: 25æœŸ (5%)
- **æ€»æˆæœ¬**: 5,000å…ƒ
- **æ€»å¥–é‡‘**: 9,920å…ƒ
- **æ€»åˆ©æ¶¦**: +4,920å…ƒ
- **ROI**: **+98.4%**
- **èƒœç‡**: 24.0%
- **å¹³å‡æ¯æœŸåˆ©æ¶¦**: +196.8å…ƒ

### Top10ç­–ç•¥

- **æŠ•æ³¨æœŸæ•°**: 50æœŸ (10%)
- **æ€»æˆæœ¬**: 7,500å…ƒ
- **æ€»å¥–é‡‘**: 11,200å…ƒ
- **æ€»åˆ©æ¶¦**: +3,700å…ƒ
- **ROI**: +49.3%
- **èƒœç‡**: 18.0%

### Top20ç­–ç•¥

- **æŠ•æ³¨æœŸæ•°**: 100æœŸ (20%)
- **æ€»æˆæœ¬**: 10,000å…ƒ
- **æ€»å¥–é‡‘**: 12,640å…ƒ
- **æ€»åˆ©æ¶¦**: +2,640å…ƒ
- **ROI**: +26.4%
- **èƒœç‡**: 11.0%

---

## âš ï¸ é‡è¦æé†’

### é£é™©è­¦å‘Š

1. **å½©ç¥¨æœ¬è´¨æ˜¯è´ŸæœŸæœ›å€¼æ¸¸æˆ**
   - åº„å®¶æŠ½æˆçº¦50%
   - æ•°å­¦ä¸Šé•¿æœŸå¿…ç„¶äºæŸ

2. **å›æµ‹æ•°æ®ä¸ä»£è¡¨æœªæ¥è¡¨ç°**
   - æ ·æœ¬é‡è¾ƒå°ï¼ˆ25-100æœŸï¼‰
   - å¯èƒ½å­˜åœ¨è¿‡æ‹Ÿåˆ
   - éœ€è¦æŒç»­ç›‘æ§å®ç›˜è¡¨ç°

3. **èµ„é‡‘ç®¡ç†**
   - å»ºè®®æ¯æ—¥æŠ•æ³¨ä¸Šé™ï¼š200å…ƒ
   - å»ºè®®æ¯æœˆæŠ•æ³¨ä¸Šé™ï¼š2000å…ƒ
   - è¿ç»­5æœŸä¸ä¸­å»ºè®®æš‚åœ

4. **ä»…ä¾›ç ”ç©¶å’Œå¨±ä¹**
   - ä¸å»ºè®®ä½œä¸ºæŠ•èµ„å·¥å…·
   - ä¸å»ºè®®å¤§é¢æŠ•æ³¨
   - è¯·ç†æ€§å‚ä¸

---

## æŠ€æœ¯æ”¯æŒ

### æ–‡æ¡£

- [é€‰æ‹©æ€§æŠ•æ³¨ç­–ç•¥æˆåŠŸæŠ¥å‘Š](../developer/SELECTIVE_BETTING_STRATEGY_SUCCESS.md)
- [æ¨¡å‹å‡†ç¡®ç‡æµ‹è¯•](../developer/MODEL_ACCURACY_TEST.md)
- [å‰ç«¯æ¶æ„è§„èŒƒ](../../.codebuddy/rules/frontend-architecture.md)

### å·¥å…·

- `tools/analysis/model_accuracy_test.py` - æ¨¡å‹å‡†ç¡®ç‡æµ‹è¯•
- `tools/analysis/selective_betting_strategy.py` - ç­–ç•¥å›æµ‹
- `tools/betting/daily_recommendation.py` - æ¯æ—¥å»ºè®®ç”Ÿæˆ
- `tools/betting/schedule_daily_recommendation.sh` - å®šæ—¶ä»»åŠ¡è„šæœ¬

### è”ç³»

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹é¡¹ç›®æ–‡æ¡£æˆ–æäº¤Issueã€‚

---

**æœ€åæ›´æ–°**: 2026-02-05  
**ç‰ˆæœ¬**: v1.0  
**æ¨èç­–ç•¥**: Top5 (å‰5%ï¼ŒROI +98.4%)
