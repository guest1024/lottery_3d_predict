# 📊 概率模型回测结果报告

**日期**: 2026-02-05  
**版本**: v2.0  
**回测期数**: 200期 (2025-07-16 ~ 2026-02-04)

---

## 🎯 回测配置

### 投注策略
- **模型**: 基于概率权重分配
- **每期投注**: 100注 (200元)
- **投注阈值**: 58.45分
- **组合选择**: Top 25个高概率组合
- **权重分配**: 指数衰减 (decay_rate = 0.85)

### 数据来源
- **总数据量**: 7,362期 (2004-10-18 ~ 2026-02-04)
- **回测数据**: 最近200期
- **数据源**: Django数据库 (LotteryPeriod)

---

## 📈 回测结果

### 整体统计

| 指标 | 数值 | 说明 |
|------|------|------|
| 回测期数 | 200期 | - |
| 投注期数 | 33期 | 16.5% |
| 观望期数 | 167期 | 83.5% |
| 总成本 | 6,600元 | 33期 × 200元 |
| 总收益 | 2,941元 | - |
| 净利润 | **-3,659元** | ❌ 亏损 |
| ROI | **-55.44%** | ❌ 负收益 |
| 中奖期数 | 5期 | - |
| 胜率 | **15.15%** | ❌ 远低于预期 |

### 中奖明细

| 类型 | 注数 | 单注奖金 | 总收益 |
|------|------|---------|--------|
| 组六 | 17注 | 173元 | 2,941元 |
| 组三 | 0注 | 346元 | 0元 |

### 按评分分层

| 评分区间 | 期数 | ROI | 胜率 | 评价 |
|---------|------|-----|------|------|
| ≥60分 | 2期 | -56.75% | 50.0% | ❌ 样本太少 |
| 58.45-60分 | 31期 | -55.35% | 12.9% | ❌ 表现差 |

---

## 🔍 问题分析

### 1. 阈值问题 ⚠️

**现象**:
- 58.45分阈值下,200期只有33期投注 (16.5%)
- 原设计预期: Top1%策略应该更频繁触发

**原因**:
- 简化评分函数与完整评分函数差异大
- 评分系统可能需要重新校准

### 2. 胜率过低 ⚠️

**现象**:
- 实际胜率: 15.15% (5/33)
- 预期: 基于历史Top1%策略应该有更高胜率

**可能原因**:
- 概率分配策略虽然优化了注数,但没有提高中奖率
- 模型预测准确度可能需要改进
- Top10数字的覆盖可能不够

### 3. 组三缺失 ⚠️

**现象**:
- 0注组三中奖
- 所有中奖都是组六

**可能原因**:
- 组三概率计算可能有问题
- 组三在候选排序中排名太低
- 指数衰减导致组三很少被选中

---

## 💡 改进建议

### 优先级1: 重新校准阈值 🔥

**当前**: 58.45分触发投注  
**建议**: 通过回测找到最优阈值

```python
# 测试不同阈值
thresholds = [50, 55, 58, 60, 65, 70]
for threshold in thresholds:
    backtest_with_threshold(threshold)
    # 分析ROI和胜率
```

**预期结果**: 找到ROI > 0 且胜率 > 20% 的阈值

### 优先级2: 改进评分系统 🔥

**问题**: 简化评分与完整评分差异大

**建议**:
1. 在回测中使用完整评分函数 (已完成)
2. 添加历史序列特征
3. 重新训练评分权重

### 优先级3: 优化概率分配 🔧

**当前策略**:
- Top 25%组合
- 指数衰减权重

**优化方向**:
1. 增加组合覆盖范围 (30-40%)
2. 调整组六/组三比例
3. 考虑概率阈值过滤

### 优先级4: 验证模型准确度 📊

**建议测试**:
1. Top5准确率
2. Top10覆盖率
3. 按评分区间的准确度

---

## 🧪 下一步测试计划

### Test 1: 阈值扫描
```bash
python tools/analysis/threshold_scan.py \
  --min 50 \
  --max 70 \
  --step 2 \
  --periods 500
```

**目标**: 找到最优投注阈值

### Test 2: 策略对比
```bash
python tools/analysis/strategy_compare.py \
  --strategies "probability,random,cover" \
  --periods 500
```

**目标**: 对比不同策略表现

### Test 3: 长期回测
```bash
python tools/analysis/long_term_backtest.py \
  --periods 1000 \
  --threshold auto
```

**目标**: 验证长期稳定性

---

## 📝 结论

### 当前状态

✅ **已完成**:
- 概率分配算法实现
- 权重分配机制
- 完整回测框架

❌ **存在问题**:
- ROI -55.44% (严重亏损)
- 胜率 15.15% (远低于预期)
- 阈值58.45分可能不适用

⚠️ **需要改进**:
- 重新校准投注阈值
- 优化评分系统
- 调整概率分配策略
- 验证模型准确度

### 推荐行动

1. **暂停使用58.45分阈值** ⚠️
2. **执行阈值扫描测试** 🔥
3. **分析模型预测准确度** 📊
4. **优化概率分配参数** 🔧
5. **重新回测验证** ✅

---

## 🔗 相关文档

- [概率分配策略](PROBABILITY_BASED_BETTING.md)
- [回测脚本](../../tools/analysis/backtest_probability_from_db.py)
- [投资策略报告](../investor/INVESTMENT_STRATEGY_REPORT.md)

---

**状态**: ⚠️ 需要优化  
**下一步**: 阈值扫描测试
